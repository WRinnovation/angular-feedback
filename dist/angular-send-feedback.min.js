angular.module("templates-angularsendfeedback",["angularsendfeedback.html"]),angular.module("angularsendfeedback.html",[]).run(["$templateCache",function(a){a.put("angularsendfeedback.html","")}]),angular.module("angular-send-feedback",["templates-angularsendfeedback"]),angular.module("angular-send-feedback").directive("angularFeedback",[function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{options:"="},link:function(a,b,c){!function(a){a.feedback=function(b){function g(){canDraw=!1,a(document).off("mouseenter mouseleave",".feedback-helper"),a(document).off("mouseup keyup"),a(document).off("mousedown",".feedback-setblackout"),a(document).off("mousedown",".feedback-sethighlight"),a(document).off("mousedown click","#feedback-close"),a(document).off("mousedown","#feedback-canvas"),a(document).off("click","#feedback-highlighter-next"),a(document).off("click","#feedback-highlighter-back"),a(document).off("click","#feedback-welcome-next"),a(document).off("click","#feedback-overview-back"),a(document).off("mouseleave","body"),a(document).off("mouseenter",".feedback-helper"),a(document).off("selectstart dragstart",document),a("#feedback-module").off("click",".feedback-wizard-close,.feedback-close-btn"),a(document).off("click","#feedback-submit"),c.highlightElement&&(a(document).off("click","#feedback-canvas"),a(document).off("mousemove","#feedback-canvas")),a('[data-highlighted="true"]').removeAttr("data-highlight-id").removeAttr("data-highlighted"),a("#feedback-module").remove(),a(".feedback-btn").show(),c.onClose.call(this)}function h(b,c){c="undefined"==typeof c||c,b.clearRect(0,0,a("#feedback-canvas").width(),a("#feedback-canvas").height()),b.fillStyle="rgba(102,102,102,0.5)",b.fillRect(0,0,a("#feedback-canvas").width(),a("#feedback-canvas").height()),a(".feedback-helper").each(function(){"highlight"==a(this).attr("data-type")&&c&&i(b,parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height())}),a(".feedback-helper").each(function(){"highlight"==a(this).attr("data-type")&&b.clearRect(parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height())}),a(".feedback-helper").each(function(){"blackout"==a(this).attr("data-type")&&(b.fillStyle="rgba(0,0,0,1)",b.fillRect(parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height()))})}function i(a,b,d,e,f){a.strokeStyle=c.strokeStyle,a.shadowColor=c.shadowColor,a.shadowOffsetX=c.shadowOffsetX,a.shadowOffsetY=c.shadowOffsetY,a.shadowBlur=c.shadowBlur,a.lineJoin=c.lineJoin,a.lineWidth=c.lineWidth,a.strokeRect(b,d,e,f),a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.lineWidth=1}var c=a.extend({ajaxURL:"",postBrowserInfo:!0,postHTML:!0,postURL:!0,postTimeStamp:!0,proxy:void 0,letterRendering:!1,initButtonText:"Send feedback",strokeStyle:"black",shadowColor:"black",shadowOffsetX:1,shadowOffsetY:1,shadowBlur:10,lineJoin:"bevel",lineWidth:3,html2canvasURL:"static/jacobscarter-angular-feedback/html2canvas.min.js",feedbackButton:".feedback-btn",showDescriptionModal:!0,isDraggable:!0,onScreenshotTaken:function(){},tpl:{initButton:'<div id="feedback-button"></div><button class="feedback-btn feedback-btn-gray">Send feedback</button></div>',description:'<div id="feedback-welcome"><div class="feedback-logo">Feedback</div><p>Feedback lets you send us suggestions about our products. We welcome problem reports, feature ideas and general comments.</p><p>Start by writing a brief description:</p><textarea id="feedback-note-tmp"></textarea><p>Next we\'ll let you identify areas of the page related to your description.</p><button id="feedback-welcome-next" class="feedback-next-btn feedback-btn-gray">Next</button><div id="feedback-welcome-error">Please enter a description.</div><div class="feedback-wizard-close"></div></div>',highlighter:'<div class="col-xs-12" id="feedback-highlighter"><div class="feedback-logo">Feedback</div><p>Click and drag on the page to help us better understand your feedback. You can move this dialog if it\'s in the way.</p><br><button class="feedback-sethighlight feedback-active"><div class="ico"></div><span>Highlight</span></button><label>Highlight areas relevant to your feedback.</label><br><button class="feedback-setblackout"><div class="ico"></div><span>Black out</span></button><label class="lower">Black out any personal information.</label><div class="feedback-buttons"><button id="feedback-highlighter-next" class="feedback-next-btn feedback-btn-gray">Next</button><button id="feedback-highlighter-back" class="feedback-back-btn feedback-btn-gray">Back</button></div><div class="feedback-wizard-close"></div></div>',overview:'<div class="col-xs-12" id="feedback-overview"><div class="feedback-logo">Feedback</div><div id="feedback-overview-description"><div class="col-xs-6" id="feedback-overview-description-text"><h3>Description</h3><!-- <h3 class="feedback-additional">Additional info</h3><div id="feedback-additional-none"><span>None</span></div><div id="feedback-browser-info"><span>Browser Info</span></div><div id="feedback-page-info"><span>Page Info</span></div><div id="feedback-timestamp"><span>Time Stamp</span></div><div id="feedback-page-structure"><span>Page Structure</span></div> --></div></div><div class="col-xs-6" id="feedback-overview-screenshot"><h3>Screenshot</h3></div><div class="feedback-buttons"><button id="feedback-submit" class="feedback-submit-btn feedback-btn-blue">Submit</button><button id="feedback-overview-back" class="feedback-back-btn feedback-btn-gray">Back</button></div><div id="feedback-overview-error">Please enter a description.</div><div class="feedback-wizard-close"></div></div>',submitSuccess:'<div class="col-xs-12" id="feedback-submit-success"><div class="feedback-logo">Feedback</div><p>Thank you for your feedback. We value every piece of feedback we receive.</p><p>We cannot respond individually to every one, but we will use your comments as we strive to improve your experience.</p><button class="feedback-close-btn feedback-btn-blue">OK</button><div class="feedback-wizard-close"></div></div>',submitError:'<div class="col-xs-12" id="feedback-submit-error"><div class="feedback-logo">Feedback</div><p>Sadly an error occurred while sending your feedback. Please try again.</p><button class="feedback-close-btn feedback-btn-blue">OK</button><div class="feedback-wizard-close"></div></div>'},onClose:function(){},screenshotStroke:!0,highlightElement:!0,initialBox:!1},b),d=!!window.HTMLCanvasElement,e=".feedback-btn"==c.feedbackButton,f=!1;d&&(e&&a("body").append(c.tpl.initButton),a(document).on("click",c.feedbackButton,function(){e&&a(this).hide(),f||a.getScript(c.html2canvasURL,function(){f=!0});var b=!1,d="",j=a(document).height(),k=a(document).width(),l='<div id="feedback-module">';c.initialBox&&(l+=c.tpl.description),l+=c.tpl.highlighter+c.tpl.overview+'<canvas id="feedback-canvas"></canvas><div id="feedback-helpers"></div><input id="feedback-note" name="feedback-note" type="hidden"></div>',a("body").append(l),moduleStyle={position:"absolute",left:"0px",top:"0px"},canvasAttr={width:k,height:j},a("#feedback-module").css(moduleStyle),a("#feedback-canvas").attr(canvasAttr).css("z-index","30000"),c.initialBox||(a("#feedback-highlighter-back").remove(),b=!0,a("#feedback-canvas").css("cursor","crosshair"),a("#feedback-helpers").show(),a("#feedback-welcome").hide(),a("#feedback-highlighter").show()),c.isDraggable&&a("#feedback-highlighter").on("mousedown",function(b){var c=a(this).addClass("feedback-draggable"),d=c.outerHeight(),e=c.outerWidth(),f=c.offset().top+d-b.pageY,g=c.offset().left+e-b.pageX;c.css("z-index",4e4).parents().on("mousemove",function(b){_top=b.pageY+f-d,_left=b.pageX+g-e,_bottom=d-b.pageY,_right=e-b.pageX,_left<0&&(_left=0),_top<0&&(_top=0),_right>a(window).width()&&(_left=a(window).width()-e),_left>a(window).width()-e&&(_left=a(window).width()-e),_bottom>a(document).height()&&(_top=a(document).height()-d),_top>a(document).height()-d&&(_top=a(document).height()-d),a(".feedback-draggable").offset({top:_top,left:_left}).on("mouseup",function(){a(this).removeClass("feedback-draggable")})}),b.preventDefault()}).on("mouseup",function(){a(this).removeClass("feedback-draggable"),a(this).parents().off("mousemove mousedown")});var m=a("#feedback-canvas")[0].getContext("2d");if(m.fillStyle="rgba(102,102,102,0.5)",m.fillRect(0,0,a("#feedback-canvas").width(),a("#feedback-canvas").height()),rect={},drag=!1,highlight=1,post={},c.postBrowserInfo&&(post.browser={},post.browser.appCodeName=navigator.appCodeName,post.browser.appName=navigator.appName,post.browser.appVersion=navigator.appVersion,post.browser.cookieEnabled=navigator.cookieEnabled,post.browser.onLine=navigator.onLine,post.browser.platform=navigator.platform,post.browser.userAgent=navigator.userAgent,post.browser.plugins=[],a.each(navigator.plugins,function(a){post.browser.plugins.push(navigator.plugins[a].name)}),a("#feedback-browser-info").show()),c.postURL&&(post.url=document.URL,a("#feedback-page-info").show()),c.postTimeStamp&&(post.timestamp=(new Date).getTime(),a("#feedback-timestamp").show()),c.postHTML&&(post.html=a("html").html(),a("#feedback-page-structure").show()),c.postBrowserInfo||c.postURL||c.postHTML||a("#feedback-additional-none").show(),a(document).on("mousedown","#feedback-canvas",function(c){b&&(rect.startX=c.pageX-a(this).offset().left,rect.startY=c.pageY-a(this).offset().top,rect.w=0,rect.h=0,drag=!0)}),a(document).on("mouseup",function(){if(b){drag=!1;var c=rect.startY,d=rect.startX,e=rect.w,f=rect.h;if(dtype="highlight",0==e||0==f)return;e<0&&(d+=e,e*=-1),f<0&&(c+=f,f*=-1),c+f>a(document).height()&&(f=a(document).height()-c),d+e>a(document).width()&&(e=a(document).width()-d),0==highlight&&(dtype="blackout"),a("#feedback-helpers").append('<div class="feedback-helper" data-type="'+dtype+'" data-time="'+Date.now()+'" style="position:absolute;top:'+c+"px;left:"+d+"px;width:"+e+"px;height:"+f+'px;z-index:30000;"></div>'),h(m),rect.w=0}}),a(document).on("mousemove",function(c){b&&drag&&(a("#feedback-highlighter").css("cursor","default"),rect.w=c.pageX-a("#feedback-canvas").offset().left-rect.startX,rect.h=c.pageY-a("#feedback-canvas").offset().top-rect.startY,m.clearRect(0,0,a("#feedback-canvas").width(),a("#feedback-canvas").height()),m.fillStyle="rgba(102,102,102,0.5)",m.fillRect(0,0,a("#feedback-canvas").width(),a("#feedback-canvas").height()),a(".feedback-helper").each(function(){"highlight"==a(this).attr("data-type")&&i(m,parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height())}),1==highlight&&(i(m,rect.startX,rect.startY,rect.w,rect.h),m.clearRect(rect.startX,rect.startY,rect.w,rect.h)),a(".feedback-helper").each(function(){"highlight"==a(this).attr("data-type")&&m.clearRect(parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height())}),a(".feedback-helper").each(function(){"blackout"==a(this).attr("data-type")&&(m.fillStyle="rgba(0,0,0,1)",m.fillRect(parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height()))}),0==highlight&&(m.fillStyle="rgba(0,0,0,0.5)",m.fillRect(rect.startX,rect.startY,rect.w,rect.h)))}),c.highlightElement){var n=[],o=[],p=0;a(document).on("mousemove click","#feedback-canvas",function(c){if(b){h(m),o=[],a("#feedback-canvas").css("cursor","crosshair"),a("* :not(body,script,iframe,div,section,.feedback-btn,#feedback-module *)").each(function(){"true"!==a(this).attr("data-highlighted")&&c.pageX>a(this).offset().left&&c.pageX<a(this).offset().left+a(this).width()&&c.pageY>a(this).offset().top+parseInt(a(this).css("padding-top"),10)&&c.pageY<a(this).offset().top+a(this).height()+parseInt(a(this).css("padding-top"),10)&&o.push(a(this))});var d=o[o.length-1];if(d&&!drag){a("#feedback-canvas").css("cursor","pointer");var e=d.offset().left-2,f=d.offset().top-2,g=d.width()+parseInt(d.css("padding-left"),10)+parseInt(d.css("padding-right"),10)+6,j=d.height()+parseInt(d.css("padding-top"),10)+parseInt(d.css("padding-bottom"),10)+6;1==highlight&&(i(m,e,f,g,j),m.clearRect(e,f,g,j),dtype="highlight"),a(".feedback-helper").each(function(){"highlight"==a(this).attr("data-type")&&m.clearRect(parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height())}),0==highlight&&(dtype="blackout",m.fillStyle="rgba(0,0,0,0.5)",m.fillRect(e,f,g,j)),a(".feedback-helper").each(function(){"blackout"==a(this).attr("data-type")&&(m.fillStyle="rgba(0,0,0,1)",m.fillRect(parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height()))}),"click"==c.type&&c.pageX==rect.startX&&c.pageY==rect.startY&&(a("#feedback-helpers").append('<div class="feedback-helper" data-highlight-id="'+p+'" data-type="'+dtype+'" data-time="'+Date.now()+'" style="position:absolute;top:'+f+"px;left:"+e+"px;width:"+g+"px;height:"+j+'px;z-index:30000;"></div>'),n.push(p),++p,h(m))}}})}a(document).on("mouseleave","body,#feedback-canvas",function(){h(m)}),a(document).on("mouseenter",".feedback-helper",function(){h(m)}),a(document).on("click","#feedback-welcome-next",function(){a("#feedback-note").val().length>0?(b=!0,a("#feedback-canvas").css("cursor","crosshair"),a("#feedback-helpers").show(),a("#feedback-welcome").hide(),a("#feedback-highlighter").show()):a("#feedback-welcome-error").show()}),a(document).on("mouseenter mouseleave",".feedback-helper",function(b){drag||(rect.w=0,rect.h=0,"mouseenter"===b.type?(a(this).css("z-index","30001"),a(this).append('<div class="feedback-helper-inner" style="width:'+(a(this).width()-2)+"px;height:"+(a(this).height()-2)+'px;position:absolute;margin:1px;"></div>'),a(this).append('<div id="feedback-close"></div>'),a(this).find("#feedback-close").css({top:-1*(a(this).find("#feedback-close").height()/2)+"px",left:a(this).width()-a(this).find("#feedback-close").width()/2+"px"}),"blackout"==a(this).attr("data-type")&&(m.clearRect(0,0,a("#feedback-canvas").width(),a("#feedback-canvas").height()),m.fillStyle="rgba(102,102,102,0.5)",m.fillRect(0,0,a("#feedback-canvas").width(),a("#feedback-canvas").height()),a(".feedback-helper").each(function(){"highlight"==a(this).attr("data-type")&&i(m,parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height())}),a(".feedback-helper").each(function(){"highlight"==a(this).attr("data-type")&&m.clearRect(parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height())}),m.clearRect(parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height()),m.fillStyle="rgba(0,0,0,0.75)",m.fillRect(parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height()),ignore=a(this).attr("data-time"),a(".feedback-helper").each(function(){return a(this).attr("data-time")==ignore||void("blackout"==a(this).attr("data-type")&&(m.fillStyle="rgba(0,0,0,1)",m.fillRect(parseInt(a(this).css("left"),10),parseInt(a(this).css("top"),10),a(this).width(),a(this).height())))}))):(a(this).css("z-index","30000"),a(this).children().remove(),"blackout"==a(this).attr("data-type")&&h(m)))}),a(document).on("click","#feedback-close",function(){if(c.highlightElement&&a(this).parent().attr("data-highlight-id"))var b=a(this).parent().attr("data-highlight-id");a(this).parent().remove(),c.highlightElement&&b&&a('[data-highlight-id="'+b+'"]').removeAttr("data-highlighted").removeAttr("data-highlight-id"),h(m)}),a("#feedback-module").on("click",".feedback-wizard-close,.feedback-close-btn",function(){g()}),a(document).on("keyup",function(a){27==a.keyCode&&g()}),a(document).on("selectstart dragstart",document,function(a){a.preventDefault()}),a(document).on("click","#feedback-highlighter-back",function(){b=!1,a("#feedback-canvas").css("cursor","default"),a("#feedback-helpers").hide(),a("#feedback-highlighter").hide(),a("#feedback-welcome-error").hide(),a("#feedback-welcome").show()}),a(document).on("mousedown",".feedback-sethighlight",function(){highlight=1,a(this).addClass("feedback-active"),a(".feedback-setblackout").removeClass("feedback-active")}),a(document).on("mousedown",".feedback-setblackout",function(){highlight=0,a(this).addClass("feedback-active"),a(".feedback-sethighlight").removeClass("feedback-active")}),a(document).on("click","#feedback-highlighter-next",function(){b=!1,a("#feedback-canvas").css("cursor","default");var e=a(document).scrollTop(),f=a(window).height();a("#feedback-helpers").hide(),a("#feedback-highlighter").hide(),c.screenshotStroke||h(m,!1),html2canvas(a("body"),{onrendered:function(b){c.screenshotStroke||h(m),_canvas=a('<canvas id="feedback-canvas-tmp" width="'+k+'" height="'+f+'"/>').hide().appendTo("body"),_ctx=_canvas.get(0).getContext("2d"),_ctx.drawImage(b,0,e,k,f,0,0,k,f),d=_canvas.get(0).toDataURL(),a(document).scrollTop(e),post.img=d,c.onScreenshotTaken(post.img),c.showDescriptionModal?(a("#feedback-canvas-tmp").remove(),a("#feedback-overview").show(),a("#feedback-overview-description-text>textarea").remove(),a("#feedback-overview-screenshot>img").remove(),a('<textarea id="feedback-overview-note">'+a("#feedback-note").val()+"</textarea>").insertAfter("#feedback-overview-description-text h3:eq(0)"),a("#feedback-overview-screenshot").append('<img class="feedback-screenshot" src="'+d+'" />')):(a("#feedback-module").remove(),g(),_canvas.remove())},proxy:c.proxy,letterRendering:c.letterRendering})}),a(document).on("click","#feedback-overview-back",function(c){b=!0,a("#feedback-canvas").css("cursor","crosshair"),a("#feedback-overview").hide(),a("#feedback-helpers").show(),a("#feedback-highlighter").show(),a("#feedback-overview-error").hide()}),a(document).on("keyup","#feedback-note-tmp,#feedback-overview-note",function(b){var c;"feedback-note-tmp"===b.target.id?c=a("#feedback-note-tmp").val():(c=a("#feedback-overview-note").val(),a("#feedback-note-tmp").val(c)),a("#feedback-note").val(c)}),a(document).on("click","#feedback-submit",function(){if(b=!1,a("#feedback-note").val().length>0){a("#feedback-submit-success,#feedback-submit-error").remove(),a("#feedback-overview").hide(),post.img=d,post.note=a("#feedback-note").val();var e={feedback:post},f=JSON.stringify(e);a.ajax({url:"function"==typeof c.ajaxURL?c.ajaxURL():c.ajaxURL,dataType:"json",contentType:"application/json",type:"POST",data:f,headers:{"Content-Type":"application/json"},success:function(){a("#feedback-module").append(c.tpl.submitSuccess)},error:function(){a("#feedback-module").append(c.tpl.submitError)}})}else a("#feedback-overview-error").show()})}))}}(jQuery),jQuery.feedback(a.options)}}}]);